---
layout: layout.njk
---

<h2>Mikey</h2>
<p>
  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent pharetra
  quam tristique, tristique velit vel, laoreet est. Morbi imperdiet nisi ut
  aliquet congue.
</p>
<p>
  In id tempus urna. Class aptent taciti sociosqu ad litora torquent per conubia
  nostra, per inceptos himenaeos. Nunc quis nisl id quam pharetra scelerisque
  sed non ante. Aliquam tincidunt nulla id enim eleifend, blandit finibus sapien
  commodo. Duis cursus dolor in eros porttitor, eu ultrices quam malesuada.
</p>
<form id="eventDateForm">
  <select name="eventDate">
    {% for day in thursdays %}
    <option value="{{ day.value }}" {{ day.selected }}>
      {{ day.value | friendlyDate }}
    </option>
    {% endfor %}
  </select>
  <button id="checkout-button">Book Your Place</button>
</form>
<script async src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe("{{ environment.stripePublishableKey }}");
  const form = document.getElementById("eventDateForm");
  form.addEventListener("submit", async function (event) {
    event.preventDefault();
    fetch("/api/create-checkout-session", {
      method: "POST",
      body: new URLSearchParams(new FormData(form)),
    })
      .then(function (response) {
        return response.json();
      })
      .then(function (session) {
        return stripe.redirectToCheckout({ sessionId: session.id });
      })
      .then(function (result) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, you should display the localized error message to your
        // customer using `error.message`.
        if (result.error) {
          alert(result.error.message);
        }
      })
      .catch(function (error) {
        console.error("Error:", error);
      });
  });
</script>
